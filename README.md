
# Hybrid Generative Modeling for Incomplete Physics: Deep Grey-Box Meets Optimal Transport

This repository implements a hybrid generative model that completes imperfect physics-based models by combining Deep Grey-Box modeling with Optimal Transport (OT). Designed for scenarios with limited and unpaired data between real-world observations and simulation outputs, the model bridges theory-driven and data-driven approaches. Unlike black-box methods, it leverages physics-informed inductive biases for greater interpretability while achieving strong generative performance. The approach refines incomplete ODE/PDE-based models by learning OT maps in data space with minimal distortion, offering both accurate system dynamics and transparent model behavior.


## Build the project
Currently, `conda` is sufficient for running the experiments, however we provide also a Docker file.

Create the conda env.
`conda create -n ot-miss python=3.10`
Activate it.
`source activate ot-miss`
Build the project.
```
pip install -r requirements.txt
pip install -e .[all]
```

## Dataset and Forward models

### Pendulum

The datasets are generated by default in the `datasets` folder.

- One to one map - Friction Damped Pendulum
  
```
## Training data
python src/forward_models/pendulum/simulate_from_conf.py --mode=one-to-one --outdir=./datasets/forward_models/pendulum/one_to_one/training/ --idx=0 --seed=1234 --n-samples=1000
## Test data
python src/forward_models/pendulum/simulate_from_conf.py --mode=one-to-one --outdir=./datasets/forward_models/pendulum/one_to_one/testing/ --idx=0 --seed=13 --n-samples=100
```

- One to 2 maps - Friction Damped Pendulum

```
# Training data
python src/forward_models/pendulum/simulate_from_conf.py --mode=one-to-many --outdir=./datasets/forward_models/pendulum/one_to_many/many_modes/training/ --idx=2 --seed=1234 --n-samples=300 &
# Test data
python src/forward_models/pendulum/simulate_from_conf.py --mode=one-to-many --outdir=./datasets/forward_models/pendulum/one_to_many/many_modes/testing/ --idx=2 --seed=13 --n-samples=200 &
```

- One to many maps - Friction Damped Pendulum

```
# Training data
python src/forward_models/pendulum/simulate_from_conf.py --mode=one-to-many --outdir=./datasets/forward_models/pendulum/one_to_many/many_modes/training/ --idx=10 --seed=1234 --n-samples=300  &
# Test data
python src/forward_models/pendulum/simulate_from_conf.py --mode=one-to-many --outdir=./datasets/forward_models/pendulum/one_to_many/many_modes/testing/ --idx=10 --seed=13 --n-samples=200  &
```

### Advection-convection Diffusion

 - One to one maps
```
python -m src.forward_models.advdiff.generate_data \
    --n-grids 20 --len-episode 50 \
    --dx 0.1 --dt 0.02 \
    --n-samples 1000 \
    --n-stoch-samples 1 \
    --range-init-mag 0.5 1.5 \
    --range-dcoeff 1e-2 1e-1 \
    --range-ccoeff 1e-1 1e-1 \
    --method rk4 \
    --fixed_stoch_samples 0 \
    --outdir=./datasets/forward_models/advdiff/one_to_one/training \
    --seed 1234

python -m src.forward_models.advdiff.generate_data \
    --n-grids 20 --len-episode 50 \
    --dx 0.1 --dt 0.02 \
    --n-samples 250 \
    --n-stoch-samples 1 \
    --range-init-mag 0.5 1.5 \
    --range-dcoeff 1e-2 1e-1 \
    --range-ccoeff 1e-1 1e-1 \
    --method rk4 \
    --fixed_stoch_samples 0 \
    --outdir=./datasets/forward_models/advdiff/one_to_one/testing \
    --seed 1
```
 - One to many maps
```
python -m src.forward_models.advdiff.generate_data \
    --n-grids 20 --len-episode 50 \
    --dx 0.1 --dt 0.02 \
    --n-samples 1500 \
    --n-stoch-samples 5 \
    --range-init-mag 0.5 1.5 \
    --range-dcoeff 1e-2 1e-1 \
    --range-ccoeff 1e-1 1e-1 \
    --method rk4 \
    --fixed_stoch_samples 0 \
    --outdir=./datasets/forward_models/advdiff/one_to_many/training \
    --seed 1234

python -m src.forward_models.advdiff.generate_data \
    --n-grids 20 --len-episode 50 \
    --dx 0.1 --dt 0.02 \
    --n-samples 500 \
    --n-stoch-samples 5 \
    --range-init-mag 0.5 1.5 \
    --range-dcoeff 1e-2 1e-1 \
    --range-ccoeff 1e-1 1e-1 \
    --method rk4 \
    --fixed_stoch_samples 0 \
    --outdir=./datasets/forward_models/advdiff/one_to_many/testing \
    --seed 1
```
### Reaction Diffusion
Change accordingly the `src/forward_models/reactdiff/params.yaml` conf file (e.g `seed` and `k`) for generating the training and the test dataset.

```python src/forward_models/reactdiff/make_dataset.py```


## Model Checkpoints and Example of Generations

## Training the model
Activate your conda environemnt
`source activate ot-miss` 

### One-to-one Pendulum
OT-Grey-box Model with odenet.
```
python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=pendulum_nnet model.h_layers=[64,64] model.activation=elu \
	model.type=det z_size=1 z_dim=0 \
	model.phys_model=pendulum model.nnet_arch=odenet model.ode_solver=rk4 \
	cost=mse gamma=0 \
	t_iters=5 disc_iters=1 \
	grad_regularizer=gopt,w2l1 grad_penalty=0.1,1 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_one/ \
	data_sampler.dataname_train_unlabeled_y=training/data_f097c1d3009fda1b72a3c6595f5c9110 \
	data_sampler.dataname_val_unlabeled_y=testing/data_6a17c4c8d5fdce009fe548e5ac173380 \
	batch_size=64 val_batch_size=128 \
	x_max_sims_budg=1000000 \
	max_epochs=10000  &
```
OT-Grey-box Model with MLP
```
python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=pendulum_nnet model.h_layers=[64,64] model.activation=leaky_relu \
	model.type=det z_size=1 z_dim=0 \
	model.phys_model=pendulum model.nnet_arch=mlp \
	cost=mse gamma=0 \
	t_iters=5 disc_iters=1 \
	grad_regularizer=gopt,w2l1 grad_penalty=0.1,1 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_one/ \
	data_sampler.dataname_train_unlabeled_y=training/data_f097c1d3009fda1b72a3c6595f5c9110 \
	data_sampler.dataname_val_unlabeled_y=testing/data_6a17c4c8d5fdce009fe548e5ac173380 \
	batch_size=64 val_batch_size=128 \
	x_max_sims_budg=1000000 \
	max_epochs=10000 &
```
W-GANS-Grey-box Model.
```
python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=pendulum_nnet model.h_layers=[64,64] model.activation=elu \
	model.type=det z_size=1 z_dim=0 \
	model.phys_model=pendulum model.nnet_arch=odenet \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_one/ \
	data_sampler.dataname_train_unlabeled_y=training/data_f097c1d3009fda1b72a3c6595f5c9110 \
	data_sampler.dataname_val_unlabeled_y=testing/data_6a17c4c8d5fdce009fe548e5ac173380 \
	batch_size=64 val_batch_size=128 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=1000000 \
	max_epochs=10000 &
```
W-GANS-Black-box Model.
```
python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=pendulum_nnet model.h_layers=[64,64] model.activation=elu \
	model.type=det z_size=1 z_dim=0 \
	model.phys_model=none model.nnet_arch=lstm  \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_one/ \
	data_sampler.dataname_train_unlabeled_y=training/data_f097c1d3009fda1b72a3c6595f5c9110 \
	data_sampler.dataname_val_unlabeled_y=testing/data_6a17c4c8d5fdce009fe548e5ac173380 \
	batch_size=64 val_batch_size=128 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=1000000,-1 \
	save_interval=1000 val_interval=1000 \
	max_epochs=1000000 &
```

- Evaluation method:

```
python src/evaluation/evaluator.py --dir_models=./multirun/2024-11-14/11-15-29/ --test_file_path=./datasets/forward_models/pendulum/one_to_one/testing/data_6a17c4c8d5fdce009fe548e5ac173380 --output_dir=./outputs/best_models/pendulum/one-mode/OT-new/abs_err --hash_exp_name=b0af176f7b1d439550e605188cbc1138 --phys_model=pendulum --params_dim=1 --z_size=1 --type_evals=lik_score --metric=abs_err --max_x_samples=20000 --max_x_batch_size=10000 --seed=1 &
```

### One-to-2 modes Pendulum
OT-Grey-box Model with odenet.
```
python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=pendulum_nnet model.h_layers=[64,64] model.activation=elu \
	model.type=stoch z_size=6 z_dim=4 z_dist=bernoulli,uniform \
	model.phys_model=pendulum model.nnet_arch=odenet \
	cost=energy gamma=1 \
	t_iters=5 disc_iters=1 \
	grad_regularizer=gopt,w2l1 grad_penalty=0.1,1 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_many/many_modes/ \
	data_sampler.dataname_train_unlabeled_y=training/data_69da0017a32f79050413105f6952a038 \
	data_sampler.dataname_val_unlabeled_y=testing/data_b59d1a9ff62efcb28bb694d2b167d8fe \
	batch_size=64 val_batch_size=128 \
	x_max_sims_budg=2500000 \
	max_epochs=10000 &
```
OT-Grey-box Model with MLP
```
python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=pendulum_nnet model.h_layers=[128,128,128] model.activation=leaky_relu \
	model.type=stoch z_size=6 z_dim=4 z_dist=bernoulli,uniform \
	model.phys_model=pendulum model.nnet_arch=mlp \
	cost=energy gamma=1 \
	t_iters=5 disc_iters=1 \
	grad_regularizer=gopt,w2l1 grad_penalty=0.1,1 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_many/many_modes/ \
	data_sampler.dataname_train_unlabeled_y=training/data_69da0017a32f79050413105f6952a038 \
	data_sampler.dataname_val_unlabeled_y=testing/data_b59d1a9ff62efcb28bb694d2b167d8fe \
	batch_size=64 val_batch_size=128 \
	x_max_sims_budg=2500000 \
	max_epochs=10000 &
```

W-GANS Grey-box Model.
```
python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=pendulum_nnet model.h_layers=[64,64] model.activation=elu \
	model.type=stoch z_size=6 z_dim=4 z_dist=bernoulli,uniform \
	model.phys_model=pendulum model.nnet_arch=odenet \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_many/many_modes/ \
	data_sampler.dataname_train_unlabeled_y=training/data_69da0017a32f79050413105f6952a038 \
	data_sampler.dataname_val_unlabeled_y=testing/data_b59d1a9ff62efcb28bb694d2b167d8fe \
	batch_size=64 val_batch_size=128 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=2500000 \
	max_epochs=10000 &
```
W-GANS-Black-box Model.
```
python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=pendulum_nnet model.h_layers=[64,64] model.activation=leaky_relu \
	model.type=stoch z_size=6 z_dim=4 z_dist=bernoulli \
	model.phys_model=none model.nnet_arch=lstm \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_many/many_modes/ \
	data_sampler.dataname_train_unlabeled_y=training/data_69da0017a32f79050413105f6952a038 \
	data_sampler.dataname_val_unlabeled_y=testing/data_b59d1a9ff62efcb28bb694d2b167d8fe \
	batch_size=64 val_batch_size=128 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=2500000,-1 \
	save_interval=1000 val_interval=1000 \
	max_epochs=1000000 &
```

- Evaluation method:
	- C2ST (with conv1d arch): 
		- ```python src/evaluation/evaluator.py \
			--dir_models=multirun/pendulum/two_modes/stable_runs/odenet \
			--test_file_path=./datasets/forward_models/pendulum/one_to_many/many_modes/testing/data_b59d1a9ff62efcb28bb694d2b167d8fe \
			--output_dir=./outputs/best_models/pendulum/two-modes/joint/new-c2st/ot-gb/ \
			--hash_exp_name=b0af176f7b1d439550e605188cbc1138 \
			--phys_model=pendulum --params_dim=1 \
			--z_size=6 \
			--type_evals=joint_score --metric=c2st --ref_metric_value=0.5 \
			--max_x_samples=20000 --max_x_batch_size=5000 --seed=1 --device=cuda --with_x_sims=1``` # for WGAN-BB with_x_sims=0
	- MMD:
		- ```python src/evaluation/evaluator.py --dir_models=multirun/pendulum/two_modes/stable_runs/odenet \
		--test_file_path=./datasets/forward_models/pendulum/one_to_many/many_modes/testing/data_b59d1a9ff62efcb28bb694d2b167d8fe \
		--output_dir=./outputs/best_models/pendulum/two-modes/joint/mmd/ot/  \
		--hash_exp_name=b0af176f7b1d439550e605188cbc1138 --phys_model=pendulum \
		--params_dim=1 --z_size=6 \
		--type_evals=joint_score --metric=mmd --max_x_samples=10000 --max_x_batch_size=1500 --seed=1 &```	


### One-to-many Pendulum

OT-Grey-box Model with odenet.
```
python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=pendulum_nnet model.h_layers=[64,64] model.activation=elu \
	model.type=stoch z_size=10 z_dim=4 z_dist=uniform \
	model.phys_model=pendulum model.nnet_arch=odenet \
	cost=energy gamma=1 \
	t_iters=10,8 disc_iters=1 \
	grad_regularizer=w2l1,gopt grad_penalty=0.1,0.3,1 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_many/many_modes/ \
	data_sampler.dataname_train_unlabeled_y=training/data_0c4be06cb37e9cdb02c2f92076ff3bef \
	data_sampler.dataname_val_unlabeled_y=testing/data_ab3c7ed9be53f93b31ea13deba72659a \
	batch_size=64 val_batch_size=128 \
	x_max_sims_budg=4000000 \
	max_epochs=10000 &
```

OT-BB one-to-many
```
python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=pendulum_nnet model.h_layers=[128,128,128] model.activation=leaky_relu \
	model.type=stoch z_size=10 z_dim=4 z_dist=uniform \
	model.phys_model=pendulum model.nnet_arch=mlp \
	cost=energy gamma=1 \
	t_iters=10 disc_iters=1 \
	grad_regularizer=gopt,w2l1 grad_penalty=0.1,1 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_many/many_modes/ \
	data_sampler.dataname_train_unlabeled_y=training/data_0c4be06cb37e9cdb02c2f92076ff3bef \
	data_sampler.dataname_val_unlabeled_y=testing/data_ab3c7ed9be53f93b31ea13deba72659a \
	batch_size=64 val_batch_size=128 \
	x_max_sims_budg=4000000 \
	save_interval=1000 val_interval=1000 \
	max_epochs=10000
```

W-GANS-Grey-box Model.
```
python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=pendulum_nnet model.h_layers=[64,64] model.activation=elu \
	model.type=det z_size=10 z_dim=4 z_dist=uniform \
	model.phys_model=pendulum model.nnet_arch=odenet \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_many/many_modes/ \
	data_sampler.dataname_train_unlabeled_y=training/data_0c4be06cb37e9cdb02c2f92076ff3bef \
	data_sampler.dataname_val_unlabeled_y=testing/data_ab3c7ed9be53f93b31ea13deba72659a \
	batch_size=64 val_batch_size=128 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=4000000 \
	max_epochs=10000 &
```

WGAN-BB 
```
python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=pendulum_nnet model.h_layers=[64] model.activation=leaky_relu \
	model.type=stoch z_size=10 z_dim=4 z_dist=uniform \
	model.phys_model=none model.nnet_arch=lstm \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	data_sampler=pendulum_data_sampler \
	data_sampler.datadir=./datasets/forward_models/pendulum/one_to_many/many_modes/ \
	data_sampler.dataname_train_unlabeled_y=training/data_0c4be06cb37e9cdb02c2f92076ff3bef \
	data_sampler.dataname_val_unlabeled_y=testing/data_ab3c7ed9be53f93b31ea13deba72659a \
	batch_size=64 val_batch_size=128 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=4000000,-1 \
	save_interval=1000 val_interval=1000 \
	max_epochs=1000000
```

- Evaluation method
  - MMD 
    - ```python src/evaluation/evaluator.py --dir_models=./multirun/2024-11-15/16-13-20/ --test_file_path=./datasets/forward_models/pendulum/one_to_many/many_modes/testing/data_ab3c7ed9be53f93b31ea13deba72659a --output_dir=./outputs/best_models/pendulum/many_modes/marginal/mmd/ot-gb/ --hash_exp_name=b0af176f7b1d439550e605188cbc1138 --phys_model=pendulum --params_dim=1 --z_size=10 --type_evals=marginal_score --metric=mmd --max_x_samples=10000 --max_x_batch_size=5000 --seed=1 &```
  - C2ST
  	- ```python src/evaluation/evaluator.py --dir_models=./multirun/2024-11-15/16-13-20/ --test_file_path=./datasets/forward_models/pendulum/one_to_many/many_modes/testing/data_ab3c7ed9be53f93b31ea13deba72659a --output_dir=./outputs/best_models/pendulum/many_modes/joint/c2st/ot-gb/ --hash_exp_name=b0af176f7b1d439550e605188cbc1138 --phys_model=pendulum --params_dim=1 --z_size=10 --type_evals=joint_score --metric=c2st --with_x_sims=1 --ref_metric_value=0.5 --max_x_samples=20000 --max_x_batch_size=5000 --seed=1 --with_x_sims=1 --device=cuda &```

### Advdiff
- One-to-many
OT-Grey-box Model with odenet.
```
python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=advdiff_nnet model.h_layers=[128,128,128] model.activation=elu \
	model.type=stoch z_size=5 z_dim=4 z_dist=uniform \
	model.phys_model=advdiff model.nnet_arch=odenet \
	cost=energy gamma=1 \
	t_iters=8 disc_iters=1 \
	grad_regularizer=w2l1,gopt grad_penalty=0.1,1 \
	data_sampler=advdiff_data_sampler \
	batch_size=64 val_batch_size=128 \
	x_max_sims_budg=4000000 \
	max_epochs=10000 &
```

OT-BB advdiff with conv1dresnet
```
python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=advdiff_nnet model.phys_model=advdiff model.nnet_arch=conv1dresnet \
	model.h_layers=4 model.activation=leaky_relu \
	model.type=stoch z_size=5 z_dim=4 z_dist=uniform \
	t_iters=8 disc_iters=1 \
	grad_regularizer=gopt,w2l1 grad_penalty=1,0.1 \
	data_sampler=advdiff_data_sampler \
	batch_size=64 val_batch_size=128 \
	x_max_sims_budg=4000000 \
	save_interval=1000 val_interval=1000 \
	max_epochs=100000
```

WGAN advdiff grey-box ODENET
```
python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=advdiff_nnet model.h_layers=[128,128,128] model.activation=elu \
	model.type=stoch z_size=5 z_dim=4 z_dist=uniform \
	model.phys_model=advdiff model.nnet_arch=odenet \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	data_sampler=advdiff_data_sampler \
	batch_size=64 val_batch_size=128 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=4000000 \
	max_epochs=10000 
```

WGAN with Resnet-GB 
```
python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=advdiff_nnet model.phys_model=advdiff model.nnet_arch=conv1dresnet \
	model.h_layers=4 model.activation=leaky_relu \
	model.type=stoch z_size=5 z_dim=4 z_dist=uniform \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	data_sampler=advdiff_data_sampler \
	batch_size=64 val_batch_size=128 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=4000000 \
	save_interval=1000 val_interval=1000 \
	max_epochs=10000 
```

WGAN Black-box model 
```
python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=advdiff_nnet model.h_layers=[100] \
	model.activation=leaky_relu model.phys_model=none model.nnet_arch=lstm \
	model.type=stoch z_size=5 z_dim=4 z_dist=uniform \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	data_sampler=advdiff_data_sampler \
	batch_size=64 val_batch_size=128 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=4000000,-1 \
	save_interval=1000 val_interval=1000 \
	max_epochs=1000000
```

- Evaluations C2ST (with MLP)
```
python src/evaluation/evaluator.py \
	--dir_models=./multirun/2024-11-18/08-13-16/ \
	--test_file_path=./datasets/forward_models/advdiff/one_to_many/testing/data_d29419fcc0c9a39ce8905e178bec7848 \
	--output_dir=./outputs/best_models/advdiff/many_modes/joint/c2st/wgan/gb/ \
	--hash_exp_name=52436e11b2400e2f7096ce284b571cd9 \
	--phys_model=advdiff --params_dim=1 \
	--z_size=5 \
	--type_evals=joint_score \
	--metric=c2st --with_x_sims=0 --ref_metric_value=0.5 \
	--max_x_samples=20000 --max_x_batch_size=1024 --seed=1 --device=cuda
```


### Reaction Diffusion model
#### One-to-one task
 - OT-Grey-box Model
```
python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=reactdiff_nnet \
	model.type=det z_size=1 z_dim=0 \
	model.phys_model=reactdiff model.nnet_arch=odenet \
	cost=mse gamma=0 \
	t_iters=10 disc_iters=1 \
	grad_regularizer=w2l1 grad_penalty=1 \
	model.ode_solver_cfg.method=rk4 \
	data_sampler=reactdiff_data_sampler \
	data_sampler.dataname_train_unlabeled_y=training/data_6d7ca3fe37f2ac0950134a4dc31a7b48.pt \
	data_sampler.dataname_val_unlabeled_y=testing/data_5c90bf1a6dd3956b1aac2e6ab52fe076.pt \
	batch_size=64 val_batch_size=64 \
	x_max_sims_budg=1500000 \
	max_epochs=100000
```
 - OT-Black-box Model - Unet ```
	python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=reactdiff_nnet \
	model.type=det z_size=1 z_dim=0 \
	model.phys_model=reactdiff model.nnet_arch=unet \
	cost=mse gamma=0 \
	t_iters=10 disc_iters=1 \
	grad_regularizer=w2l1 grad_penalty=1 \
	model.ode_solver_cfg.method=rk4 \
	data_sampler=reactdiff_data_sampler \
	data_sampler.dataname_train_unlabeled_y=training/data_6d7ca3fe37f2ac0950134a4dc31a7b48.pt \
	data_sampler.dataname_val_unlabeled_y=testing/data_5c90bf1a6dd3956b1aac2e6ab52fe076.pt \
	batch_size=64 val_batch_size=64 \
	x_max_sims_budg=1500000 \
	max_epochs=100000 
	```
 - WGANS - GreyBox model ```
	python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=reactdiff_nnet model.activation=elu \
	model.type=det z_size=1 z_dim=0 \
	model.phys_model=reactdiff model.nnet_arch=odenet \
	cost=mse gamma=0 \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	model.ode_solver_cfg.method=rk4 \
	data_sampler=reactdiff_data_sampler \
	data_sampler.dataname_train_unlabeled_y=training/data_6d7ca3fe37f2ac0950134a4dc31a7b48.pt \
	data_sampler.dataname_val_unlabeled_y=testing/data_5c90bf1a6dd3956b1aac2e6ab52fe076.pt \
	batch_size=64 val_batch_size=64 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=1500000 \
	max_epochs=10000
	```

 - WGANs BB ```
 	python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=reactdiff_nnet model.activation=elu \
	model.type=det z_size=1 z_dim=0 \
	model.phys_model=none \
	model.nnet_arch=lstm model.h_layers=[2048] model.c_embed_dim=64 \ 
	cost=mse gamma=0 \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	model.ode_solver_cfg.method=rk4 \
	data_sampler=reactdiff_data_sampler \
	data_sampler.dataname_train_unlabeled_y=training/data_6d7ca3fe37f2ac0950134a4dc31a7b48.pt \
	data_sampler.dataname_val_unlabeled_y=testing/data_5c90bf1a6dd3956b1aac2e6ab52fe076.pt \
	batch_size=64 val_batch_size=64 \
	lr=[1e-4,1e-4] betas_lr=[0.,0.999] \
	x_max_sims_budg=1500000 \
	max_epochs=10000
	```

Evaluation
```
python src/evaluation/evaluator.py \
	--dir_models=./multirun/2024-12-05/ \
	--test_file_path=./datasets/forward_models/reactdiff/testing/data_5c90bf1a6dd3956b1aac2e6ab52fe076.pt \
	--output_dir=./outputs/best_models/reactdiff/one-to-one/abs_err \
	--hash_exp_name=6fbb54c610491cfd3340899ffe247f30 \
	--phys_model=reactdiff \
	--params_dim=2 --z_size=1 \
	--type_evals=lik_score --metric=abs_err \
	--max_x_samples=20000 --max_x_batch_size=1000 \
	--seed=1 &
```
#### One-to-many task
OT-Grey-box Model
```
python src/train/__hydra__launcher.py -m algorithm_name=knot \
	model=reactdiff_nnet model.activation=elu \
	model.type=stoch z_size=5 z_dim=2 \
	model.phys_model=reactdiff model.nnet_arch=odenet \
	cost=energy gamma=1 \
	t_iters=10 disc_iters=1 \
	grad_regularizer=w2l1 grad_penalty=10 \
	model.ode_solver_cfg.method=rk4 \
	data_sampler=reactdiff_data_sampler \
	data_sampler.online=false \
	dataname_train_labeled_sims=training/61a0a9280e623987eeee47cb59a4d60a \
	data_sampler.dataname_train_unlabeled_y=training/27ba394232e3f184fbb3523cac53d873 \
	data_sampler.dataname_val_unlabeled_y=testing/5bbd3b5f3c2f719767ffe3ab76afd173 \
	lazy_loading=true \
	batch_size=64 val_batch_size=64 \
	x_max_sims_budg=1000000 \
	max_epochs=100000  &
```

WGANS GB model
```
python src/train/__hydra__launcher.py -m algorithm_name=wgans \
	model=reactdiff_nnet model.activation=elu \
	model.type=stoch z_size=5 z_dim=2 \
	model.phys_model=reactdiff model.nnet_arch=odenet \
	cost=energy gamma=0 \
	t_iters=1 disc_iters=5 \
	grad_regularizer=w2l1 grad_penalty=10 \
	model.ode_solver_cfg.method=rk4 \
	data_sampler=reactdiff_data_sampler \
	data_sampler.online=false \
	dataname_train_labeled_sims=training/61a0a9280e623987eeee47cb59a4d60a \
	data_sampler.dataname_train_unlabeled_y=training/27ba394232e3f184fbb3523cac53d873 \
	data_sampler.dataname_val_unlabeled_y=testing/5bbd3b5f3c2f719767ffe3ab76afd173 \
	lazy_loading=true \
	batch_size=64 val_batch_size=64 \
	x_max_sims_budg=4000000 \
	max_epochs=100000  &
```

Evaluation

```
python src/evaluation/evaluator.py \
	--dir_models=./multirun/reactdiff/one-to-many/ot-gb/ \
	--test_file_path=./datasets/forward_models/reactdiff/testing/testing/5bbd3b5f3c2f719767ffe3ab76afd173 \
	--output_dir=./outputs/best_models/reactdiff/one-to-many/c2st/ot-gb \
	--hash_exp_name=6fbb54c610491cfd3340899ffe247f30 \
	--phys_model=reactdiff --params_dim=2 \
	--z_size=5 \
	--type_evals=joint_score \
	--metric=c2st --ref_metric_value=0.5 --with_x_sims=0 \
	--max_x_samples=20000 \
	--max_x_batch_size=128 \
	--seed=13 &
```